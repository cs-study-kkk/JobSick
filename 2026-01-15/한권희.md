자신의 iP 주소를 변경하는 방법은? 

어떻게 자동으로 설정 되는가?

이를 위해 중요한 프로토콜

# DHCP

- Dynamic Host Configuration Protocol
- 말 그대로 동적으로 호스트를 설정하는 프로토콜이다.
- 네트워크에 접속한 장치의 IP, subnet mask, gatway addr, DNS와 같은 정보를 자동으로 설정해 주는 기술.

<img width="1050" height="570" alt="image" src="https://github.com/user-attachments/assets/02ee637f-2170-4a99-b1d3-d2a3dd23a1b4" />


만약 이 상태에서 PC를 하나 추가해 공유기에 연결하면

<img width="920" height="602" alt="image" src="https://github.com/user-attachments/assets/36932dcf-0432-49d1-b46d-d24e889330e6" />


원래라면 이 PC의 IP addr를 우리가 직접 설정해야 한다.

192.168.0.3이 되냐? 놉 같은 IP가 있으면 안된다.(식별자이니 같은 범위내 중복 금지) 따라서 4, 5… 이렇게 해야겠죠

직접 IP를 설정하고자 하면
제어판에서 귀찮은 작업들이 필요하다.

그래서 자동으로 ip를 할당받고 싶다. ⇒ 케이블을 장착 또는 무선으로 연결하면 자동으로 동적으로 ip 주소와 dns와 서브넷과 게이트웨이 주소와 같은 복잡한 정보들이 설정이 된다. 

- 이를 위해서 dhcp 서버가 필요하다.
- 공유기는 dhcp 서버를 보통 내장하고 있음
- 동시에 인터넷을 사용하는 기계들에는 dhcp 클라이언트가 내장되어있다.



새로운 PC를 공유기에 딱 연결을 하면 자동으로 

<img width="1314" height="659" alt="image" src="https://github.com/user-attachments/assets/7873e998-b8fb-4c15-9321-73a5711f62d1" />


DHCP 클라이언트가 이 공유기 안에 서버가 있나요? 하고 MAC 주소를 알려준다. → IP 주소 지금 없으니까 하나 주세요 하고

그러면 

<img width="1121" height="615" alt="image" src="https://github.com/user-attachments/assets/9b702a04-9e01-4f19-acd9-7fdbabfaadf6" />


DHCP 서버가 8C에게 나는 88인데 192.168.0.4라는 ip를 임대해 줄 수 있다고 알려준다. 

→ 이게 가능한 이유는 2번과 3번 모두 dhcp 서버에 ip를 임대한 상황이고 이 서버가 이를 알고 있으니.

그리고 

<img width="1018" height="690" alt="image" src="https://github.com/user-attachments/assets/8e64a017-1cd8-4062-bee5-cb96a2db7b01" />


PC가 이 IP주소 쓰겠다고 보냄

그러면 DHCP 서버는 8C로 시작하는 PC는 4 IP를 임대했다고 저장하고 

임대 시간을 DHCP 클라이언트에 알려준다.

그리고 DHCP 클라이언트는 해당 IP를 설정해서 자동으로 IP와 같은 복잡한 정보들을 얻게 된다.

---

정리를 해보면 

**IP 주소 할당 절차**

PC와 같은 단말이 DHCP 서버로부터 IP 주소 등의 네트워크 정보를 할당받기 위해서는

DHCP Discover -> DHCP Offer -> DHCP Request ->DHCP Ack 

| **단계** |  | **공식 용어** | **설명**  |
| --- | --- | --- | --- |
| **1단계** | DHCP 서버가 있나요? IP 주소 하나 주세요 | **DHCP Discover** | 클라이언트가 네트워크에 브로드캐스트로 서버를 찾는 과정. |
| **2단계** | 나는 88 서버인데 192.168.0.4 사용 가능해요 | **DHCP Offer** | 서버가 클라이언트에게 할당 가능한 IP 주소 정보를 제안하는 과정 |
| **3단계** | 192.168.0.4 사용하겠습니다 | **DHCP Request** | 클라이언트가 제안받은 IP를 사용하겠다고 서버(및 다른 서버들)에 알리는 과정 |
| **4단계** | 임대 시간은 이만큼이다. | **DHCP Ack** (Acknowledgement) | 서버가 최종적으로 IP 사용을 승인하고 네트워크 정보를 전달하는 과정 |

++) 

- **UDP 프로토콜 사용:** DHCP는 **UDP** 프로토콜을 사용하며, 서버는 67번 포트, 클라이언트는 68번 포트를 사용한다.
- (단지 빠르다는 이유로 UDP 사용xx)
    - 브로드캐스트(Broadcast) 지원
        - **상황:** 갓 연결된 PC는 자신의 IP도 없고, DHCP 서버가 어디 있는지도 모름. 그래서  네트워크 전체에 소리친다.(Broadcast)
        - **UDP:** **1:다(N) 통신인 브로드캐스트를 지원**
        
    - 연결 설정 불가능 (No 3-Way Handshake)
        - **TCP의 문제:** 연결을 맺으려면 서로의 IP 주소를 알아야 패킷을 주고받을 수 있다. 하지만 클라이언트는 **아직 IP 주소가 없기 때문에** TCP 연결 자체를 시작할 수 없다.
        - **UDP의 장점:** 연결 과정 없이 그냥 패킷을 던지면 되므로, IP가 없는 상태에서도 통신이 가능
    - 속도와 효율성
        - DHCP의 대화 과정(DORA)은 매우 짧고 단순하다.
        - 고작 IP 주소 하나 받자고 무거운 TCP 연결을 맺고, 끊고, 신뢰성을 체크하는 것은 부담
        - 서버 입장에서도 수많은 PC의 연결 상태(Session)를 계속 유지하는 것보다, 단순히 들어오는 요청에 응답만 해주는 UDP 방식이 리소스 소모가 훨씬 적다.
- **임대 갱신 (Renewal):** "임대 시간이 다 되면 어떻게 되나요?"
    - 보통 임대 시간의 50%가 지났을 때 클라이언트가 자동으로 사용 시간을 연장(갱신) 요청한다

---

**브로드캐스팅 (Broadcasting)**

- **의미:** 송신 호스트가 네트워크에 연결된 **모든** 호스트에게 데이터를 전송하는 방식.
- **예시:** 처음 공유기에 연결했을 때 **"여기 DHCP 서버 있나?"** 하고 소리치던 상황 (내 IP도, 서버 IP도 모를 때).

**유니캐스트 (Unicast)**

- **의미:** 고유 주소로 식별된 **하나의** 네트워크 목적지에 **1:1**로 데이터를 전송하는 방식.
- **예시:** 임대 연장이나 반납할 때 **"192.168.0.1야, 나 0.4인데"** 하고 콕 집어 말하는 상황 (서로 주소를 알 때).

---

## **IP 주소 임대기간 연장 순서**

처음 만났을 때와 달리, 이제는 **서로의 주소(IP)를 알고 있기 때문에** 동네방네 소리치지(Broadcast) 않고 1:1로 조용히(Unicast) 대화한다.

1. **DHCP Request**(유니캐스트)
    1. **PC (192.168.0.4):**
    "192.168.0.1 공유기야, 아까 IP 받아간 **192.168.0.4**인데요. 이거 임대 기간 좀 연장 해줘”
        1. 단말과 서버가 서로의 IP를 알기 때문에, 내 IP 주소를  1:1로 보냄
2. DHCP Ack (유니캐스트)
    1. **DHCP 서버 (192.168.0.1):**
    "OK. **192.168.0.4** 주소 2시간 더 쓰세요."
        
        *서버도 PC에게 1:1로 승인 메시지를 보낸다.*
        

---

## **IP 주소 반납 순서**

PC를 끄거나 연결을 끊을 때, 다 썼다고 알려주는 과정

1. DHCP Release (유니캐스트)
    1. **PC (192.168.0.4):**
    "192.168.0.1 공유기야, 나 이제 컴퓨터 끔. 그동안 썼던 **192.168.0.4**는 반납."
        1. 서버에게 반납 의사를 1:1로 전달하고, 서버는 이 IP를 회수하여 다른 기기에게 줄 준비
        

**DHCP Release**

" 1.1.1.252주소를 가진 DHCP 서버님. 그동안 사용했던 IP주소 1.1.1.66을 반납하겠습니다"

라는 이 DHCP Release 메시지를 Unicasting으로 서버에 전달, IP 주소를 반환하게 됩니다.

- 브로드캐스팅(broadcasting)

송신 호스트가 전송한 데이터가 네트워크에 연결된 모든 호스트에 전송되는 방식을 의미한다.

- 유니캐스트(unicast) 전송이란

고유 주소로 식별된 하나의 네트워크 목적지에 1:1로 트래픽 또는 메시지를 전송하는 방식을 말한다.

---

### 참고 자료

- https://opentutorials.org/course/3265/20039
- https://net0.tistory.com/8
