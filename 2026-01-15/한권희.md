# 자신의 IP 주소를 변경하는 방법과 원리

자신의 IP 주소는 어떻게 자동으로 설정되는가? 이를 이해하기 위해 가장 중요한 프로토콜이 바로 **DHCP**이다.

## 1. DHCP (Dynamic Host Configuration Protocol)

- **정의:** 동적 호스트 구성 프로토콜. 말 그대로 호스트(Host)를 동적으로 설정하는 프로토콜이다.
- **역할:** 네트워크에 접속한 장치의 **IP Address, Subnet Mask, Gateway Address, DNS**와 같은 정보를 자동으로 설정해 주는 기술이다.

<img width="1050" height="570" alt="image" src="https://github.com/user-attachments/assets/02ee637f-2170-4a99-b1d3-d2a3dd23a1b4" />

만약 이 상태에서 PC를 하나 추가해 공유기에 연결한다고 가정해 보자.

<img width="920" height="602" alt="image" src="https://github.com/user-attachments/assets/36932dcf-0432-49d1-b46d-d24e889330e6" />

원래라면 이 PC의 IP Address를 우리가 직접 설정해야 한다.
`192.168.0.3`을 써도 될까? **안 된다.** IP는 식별자이므로 같은 네트워크 범위 내에서 중복되면 안 되기 때문이다. 따라서 4, 5... 와 같이 비어있는 번호를 찾아야 한다.

하지만 직접 IP를 설정하려면 제어판에 들어가서 설정하는 등 번거로운 작업이 필요하다.
그래서 **"자동으로 IP를 할당받고 싶다"**는 요구가 생겼고, 케이블을 연결하거나 와이파이에 접속하면 자동으로 IP, DNS, 서브넷, 게이트웨이와 같은 복잡한 정보들이 설정되도록 만들었다.

- 이를 위해 **DHCP 서버**가 필요하다. (보통 공유기에 내장되어 있음)
- 인터넷을 사용하는 기기들에는 **DHCP 클라이언트**가 내장되어 있다.

---

## 2. IP 할당 과정 (DORA)

새로운 PC를 공유기에 연결하면 다음과 같은 과정이 자동으로 일어난다.

<img width="1314" height="659" alt="image" src="https://github.com/user-attachments/assets/7873e998-b8fb-4c15-9321-73a5711f62d1" />

**1. DHCP Discover**
DHCP 클라이언트가 "이 공유기 안에 서버가 있나요? IP 주소 지금 없으니까 하나 주세요."라고 자신의 MAC 주소와 함께 요청을 보낸다.

<img width="1121" height="615" alt="image" src="https://github.com/user-attachments/assets/9b702a04-9e01-4f19-acd9-7fdbabfaadf6" />

**2. DHCP Offer**
DHCP 서버가 클라이언트에게 "나는 88번 서버인데, `192.168.0.4`라는 IP를 임대해 줄 수 있어."라고 알려준다.
(서버는 이미 할당된 2, 3번 IP를 알고 있으므로 중복되지 않는 4번을 제안한다.)

<img width="1018" height="690" alt="image" src="https://github.com/user-attachments/assets/8e64a017-1cd8-4062-bee5-cb96a2db7b01" />

**3. DHCP Request**
PC가 "좋아, 그 IP 주소(`192.168.0.4`) 쓰겠습니다."라고 보낸다.

**4. DHCP Ack**
DHCP 서버는 해당 PC가 4번 IP를 임대했다고 저장하고, **임대 시간**을 클라이언트에게 알려주며 최종 승인한다. 클라이언트는 이 정보를 바탕으로 네트워크 설정을 완료한다.

### 요약: IP 주소 할당 절차
**DHCP Discover → DHCP Offer → DHCP Request → DHCP Ack**

| 단계 | 공식 용어 | 설명 | 전송 방식 |
| --- | --- | --- | --- |
| **1단계** | **DHCP Discover** | (클라이언트 → 서버) DHCP 서버가 있나요? IP 주세요. | Broadcast |
| **2단계** | **DHCP Offer** | (서버 → 클라이언트) `192.168.0.4` 사용 가능합니다. | Broadcast / Unicast |
| **3단계** | **DHCP Request** | (클라이언트 → 서버) 네, `192.168.0.4` 사용하겠습니다. | Broadcast |
| **4단계** | **DHCP Ack** | (서버 → 클라이언트) 승인합니다. 임대 시간은 O시간입니다. | Broadcast / Unicast |

---

## 3. DHCP의 기술적 특징 (UDP 사용 이유)

**Q. 왜 신뢰성 있는 TCP가 아니라 UDP를 사용하는가?**
단지 속도가 빠르다는 이유 때문만이 아니다.

1.  **브로드캐스트(Broadcast) 지원 필요**
    * **상황:** 갓 연결된 PC는 자신의 IP도 없고, DHCP 서버가 어디 있는지도 모른다. 그래서 네트워크 전체에 "누구 없소?" 하고 소리쳐야 한다.
    * **이유:** TCP는 1:1 연결만 지원하지만, **UDP는 1:N 통신인 브로드캐스트를 지원**한다.

2.  **연결 설정 불가능 (No 3-Way Handshake)**
    * **TCP의 문제:** TCP 연결을 맺으려면 서로의 IP 주소를 알아야 패킷을 주고받을 수 있다. 하지만 클라이언트는 **아직 IP 주소가 없기 때문에** TCP 연결 자체를 시작할 수 없다.
    * **UDP의 장점:** 연결 과정 없이 패킷을 던질 수 있으므로, IP가 없는 상태에서도 통신이 가능하다.

3.  **속도와 효율성**
    * DHCP의 대화 과정(DORA)은 매우 짧고 단순하다.
    * 고작 IP 주소 하나 받자고 무거운 TCP 연결을 맺고, 끊고, 신뢰성을 체크하는 것은 비효율적이다.
    * 서버 입장에서도 수많은 PC의 연결 상태(Session)를 유지하는 것보다, 단순히 들어오는 요청에 응답만 해주는 UDP 방식이 리소스 소모가 적다.

> **참고:** DHCP 서버는 67번 포트, 클라이언트는 68번 포트를 사용한다.

---

## 4. IP 주소 관리 (임대 갱신과 반납)

초기 할당 과정과 달리, **이제는 서로의 IP 주소를 알고 있기 때문에** 동네방네 소리치지(Broadcast) 않고 1:1로 조용히(Unicast) 대화한다.

### 용어 정리
* **브로드캐스팅 (Broadcasting):** "여기 DHCP 서버 있나?"처럼 불특정 다수(모든 호스트)에게 전송하는 방식.
* **유니캐스트 (Unicast):** "야 1번아, 나 4번인데~"처럼 정확한 목적지 주소로 1:1 전송하는 방식.

### A. 임대 갱신 (Renewal)
보통 임대 시간의 50%가 지났을 때 클라이언트가 자동으로 사용 시간 연장을 요청한다.

1.  **DHCP Request (Unicast)**
    * **PC (`192.168.0.4`):** "`192.168.0.1` 공유기야, 아까 받은 **0.4**번 IP 임대 기간 좀 연장해 줘."
2.  **DHCP Ack (Unicast)**
    * **DHCP 서버 (`192.168.0.1`):** "OK. 2시간 더 써라."

### B. 반납 (Release)
PC를 끄거나 연결을 끊을 때 IP를 반환한다.

1.  **DHCP Release (Unicast)**
    * **PC (`192.168.0.4`):** "`192.168.0.1`님, 나 이제 컴퓨터 끔. 쓰던 **0.4**번 반납함."
    * 서버는 이 IP를 회수하여 다른 기기에게 할당할 준비를 한다.

---

### 참고 자료

- https://opentutorials.org/course/3265/20039
- https://net0.tistory.com/8
